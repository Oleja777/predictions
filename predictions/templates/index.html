<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Predictions Dashboard</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 24px;
        color: #1f2937;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 16px;
      }
      th, td {
        padding: 8px 10px;
        border-bottom: 1px solid #e5e7eb;
        text-align: left;
        font-size: 14px;
      }
      th {
        background: #f3f4f6;
      }
      tr:hover {
        background: #f9fafb;
      }
      .muted {
        color: #6b7280;
      }
    </style>
  </head>
  <body>
    <h1>Signals</h1>
    <div class="muted">Auto-refreshes every 60 seconds.</div>
    <table id="signals-table">
      <thead>
        <tr>
          <th>Market</th>
          <th>Time</th>
          <th>Vol 15m</th>
          <th>Trades 15m</th>
          <th>Price %</th>
          <th>Vol Anom</th>
          <th>Trades Anom</th>
          <th>Top addresses</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const tableBody = document.querySelector('#signals-table tbody');

      function formatAddresses(topAddresses) {
        if (!topAddresses || topAddresses.length === 0) return '-';
        return topAddresses.map(entry => `${entry.address} (${entry.count})`).join(', ');
      }

      function renderRows(signals) {
        tableBody.innerHTML = '';
        signals.forEach(signal => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${signal.market}</td>
            <td>${new Date(signal.timestamp).toLocaleString()}</td>
            <td>${Number(signal.vol_15m).toFixed(4)}</td>
            <td>${signal.trades_15m}</td>
            <td>${Number(signal.price_change_pct).toFixed(2)}%</td>
            <td>${Number(signal.anomaly_volume_ratio).toFixed(2)}x</td>
            <td>${Number(signal.anomaly_trades_ratio).toFixed(2)}x</td>
            <td>${formatAddresses(signal.top_addresses)}</td>
          `;
          tableBody.appendChild(row);
        });
      }

      async function fetchSignals() {
        const response = await fetch('/api/signals');
        const signals = await response.json();
        renderRows(signals);
      }

      fetchSignals();
      setInterval(fetchSignals, 60000);
    </script>
  </body>
</html>
